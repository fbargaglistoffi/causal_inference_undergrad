<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1 Foundations of Causal Thinking in Public Health | Causal-Inference-Graduate.knit</title>
  <meta name="description" content="An undergraduate course on causal inference" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="1 Foundations of Causal Thinking in Public Health | Causal-Inference-Graduate.knit" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="An undergraduate course on causal inference" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1 Foundations of Causal Thinking in Public Health | Causal-Inference-Graduate.knit" />
  
  <meta name="twitter:description" content="An undergraduate course on causal inference" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="setup.html"/>
<link rel="next" href="randomized-control-trials.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Causal Inference</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-description"><i class="fa fa-check"></i>Course Description</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#instructor"><i class="fa fa-check"></i>Instructor</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#teaching-assistants"><i class="fa fa-check"></i>Teaching Assistants</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-logistics"><i class="fa fa-check"></i>Course Logistics</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#required-materials"><i class="fa fa-check"></i>Required Materials</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#learning-objectives"><i class="fa fa-check"></i>Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#upon-successful-completion-of-this-course-students-will-be-able-to"><i class="fa fa-check"></i>Upon successful completion of this course, students will be able to:</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#tools"><i class="fa fa-check"></i>Tools</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#useful-links"><i class="fa fa-check"></i>Useful Links</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i>Setup</a>
<ul>
<li class="chapter" data-level="" data-path="setup.html"><a href="setup.html#installing-and-using-required-packages"><i class="fa fa-check"></i>Installing and Using Required Packages</a></li>
<li class="chapter" data-level="" data-path="setup.html"><a href="setup.html#loading-packages"><i class="fa fa-check"></i>Loading Packages</a></li>
<li class="chapter" data-level="" data-path="setup.html"><a href="setup.html#difference-between-install.packages-and-library"><i class="fa fa-check"></i>Difference Between install.packages() and library()</a></li>
<li class="chapter" data-level="" data-path="setup.html"><a href="setup.html#session-information"><i class="fa fa-check"></i>Session Information</a></li>
<li class="chapter" data-level="" data-path="setup.html"><a href="setup.html#why-include-this"><i class="fa fa-check"></i>Why include this?</a></li>
<li class="chapter" data-level="" data-path="setup.html"><a href="setup.html#base-r-version-simple"><i class="fa fa-check"></i>Base R version (simple)</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="foundations-of-causal-thinking-in-public-health.html"><a href="foundations-of-causal-thinking-in-public-health.html"><i class="fa fa-check"></i><b>1</b> Foundations of Causal Thinking in Public Health</a>
<ul>
<li class="chapter" data-level="1.1" data-path="foundations-of-causal-thinking-in-public-health.html"><a href="foundations-of-causal-thinking-in-public-health.html#association-vs.-causation"><i class="fa fa-check"></i><b>1.1</b> Association vs. Causation</a></li>
<li class="chapter" data-level="1.2" data-path="foundations-of-causal-thinking-in-public-health.html"><a href="foundations-of-causal-thinking-in-public-health.html#introduction-to-counterfactuals-and-potential-outcomes"><i class="fa fa-check"></i><b>1.2</b> Introduction to Counterfactuals and Potential Outcomes</a></li>
<li class="chapter" data-level="1.3" data-path="foundations-of-causal-thinking-in-public-health.html"><a href="foundations-of-causal-thinking-in-public-health.html#causal-estimands-and-identification"><i class="fa fa-check"></i><b>1.3</b> Causal Estimands and Identification</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="randomized-control-trials.html"><a href="randomized-control-trials.html"><i class="fa fa-check"></i><b>2</b> Randomized Control Trials</a>
<ul>
<li class="chapter" data-level="2.1" data-path="randomized-control-trials.html"><a href="randomized-control-trials.html#randomized-controlled-trials-the-gold-standard"><i class="fa fa-check"></i><b>2.1</b> Randomized controlled trials: the gold standard</a></li>
<li class="chapter" data-level="2.2" data-path="randomized-control-trials.html"><a href="randomized-control-trials.html#basic-experimental-design-principles"><i class="fa fa-check"></i><b>2.2</b> Basic Experimental Design Principles</a></li>
<li class="chapter" data-level="2.3" data-path="randomized-control-trials.html"><a href="randomized-control-trials.html#limitations-of-rcts-in-public-health-contexts"><i class="fa fa-check"></i><b>2.3</b> Limitations of RCTs in Public Health Contexts</a></li>
<li class="chapter" data-level="2.4" data-path="randomized-control-trials.html"><a href="randomized-control-trials.html#common-threats-to-internal-and-external-validity"><i class="fa fa-check"></i><b>2.4</b> Common Threats to Internal and External Validity</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="observational-studies.html"><a href="observational-studies.html"><i class="fa fa-check"></i><b>3</b> Observational Studies</a>
<ul>
<li class="chapter" data-level="3.1" data-path="observational-studies.html"><a href="observational-studies.html#the-challenge-of-confounding-in-public-health-and-medical-research"><i class="fa fa-check"></i><b>3.1</b> The challenge of confounding in public health and medical research</a></li>
<li class="chapter" data-level="3.2" data-path="observational-studies.html"><a href="observational-studies.html#exchangeability-positivity-and-consistency"><i class="fa fa-check"></i><b>3.2</b> Exchangeability, positivity, and consistency</a></li>
<li class="chapter" data-level="3.3" data-path="observational-studies.html"><a href="observational-studies.html#effect-identification-in-observational-studies"><i class="fa fa-check"></i><b>3.3</b> Effect Identification in Observational Studies</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="randomized-controlled-trials-rcts-and-quasi-experiments.html"><a href="randomized-controlled-trials-rcts-and-quasi-experiments.html"><i class="fa fa-check"></i><b>4</b> Randomized Controlled Trials (RCTs) and Quasi-Experiments</a>
<ul>
<li class="chapter" data-level="4.1" data-path="randomized-controlled-trials-rcts-and-quasi-experiments.html"><a href="randomized-controlled-trials-rcts-and-quasi-experiments.html#effect-modification-and-adjustment-methods"><i class="fa fa-check"></i><b>4.1</b> Effect Modification and Adjustment Methods</a></li>
<li class="chapter" data-level="4.2" data-path="randomized-controlled-trials-rcts-and-quasi-experiments.html"><a href="randomized-controlled-trials-rcts-and-quasi-experiments.html#identifying-interaction"><i class="fa fa-check"></i><b>4.2</b> Identifying Interaction</a></li>
<li class="chapter" data-level="4.3" data-path="randomized-controlled-trials-rcts-and-quasi-experiments.html"><a href="randomized-controlled-trials-rcts-and-quasi-experiments.html#effect-modification-vs-interaction"><i class="fa fa-check"></i><b>4.3</b> Effect Modification vs Interaction</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="introduction-to-causal-diagrams.html"><a href="introduction-to-causal-diagrams.html"><i class="fa fa-check"></i><b>5</b> Introduction to Causal Diagrams</a>
<ul>
<li class="chapter" data-level="5.1" data-path="introduction-to-causal-diagrams.html"><a href="introduction-to-causal-diagrams.html#basic-principles-of-directed-acyclic-graphs-dags"><i class="fa fa-check"></i><b>5.1</b> Basic principles of directed acyclic graphs (DAGs)</a></li>
<li class="chapter" data-level="5.2" data-path="introduction-to-causal-diagrams.html"><a href="introduction-to-causal-diagrams.html#common-causal-structures-in-public-health"><i class="fa fa-check"></i><b>5.2</b> Common Causal Structures in Public Health</a></li>
<li class="chapter" data-level="5.3" data-path="introduction-to-causal-diagrams.html"><a href="introduction-to-causal-diagrams.html#using-dags-to-introduce-and-understand-selection-bias"><i class="fa fa-check"></i><b>5.3</b> Using DAGs to introduce and understand selection bias</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="effect-modification-and-interaction.html"><a href="effect-modification-and-interaction.html"><i class="fa fa-check"></i><b>6</b> Effect Modification and Interaction</a>
<ul>
<li class="chapter" data-level="6.1" data-path="effect-modification-and-interaction.html"><a href="effect-modification-and-interaction.html#the-structure-of-confounding"><i class="fa fa-check"></i><b>6.1</b> The Structure of Confounding</a></li>
<li class="chapter" data-level="6.2" data-path="effect-modification-and-interaction.html"><a href="effect-modification-and-interaction.html#how-to-adjust-for-confounding"><i class="fa fa-check"></i><b>6.2</b> How to Adjust for Confounding</a></li>
<li class="chapter" data-level="6.3" data-path="effect-modification-and-interaction.html"><a href="effect-modification-and-interaction.html#the-form-of-selection-bias"><i class="fa fa-check"></i><b>6.3</b> The Form of Selection Bias</a></li>
<li class="chapter" data-level="6.4" data-path="effect-modification-and-interaction.html"><a href="effect-modification-and-interaction.html#how-to-adjust-for-selection-bias"><i class="fa fa-check"></i><b>6.4</b> How to Adjust for Selection Bias</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="measurement-missing-data-and-selection-bias.html"><a href="measurement-missing-data-and-selection-bias.html"><i class="fa fa-check"></i><b>7</b> Measurement, Missing Data, and Selection Bias</a>
<ul>
<li class="chapter" data-level="7.1" data-path="measurement-missing-data-and-selection-bias.html"><a href="measurement-missing-data-and-selection-bias.html#measurement-bias"><i class="fa fa-check"></i><b>7.1</b> Measurement Bias</a></li>
<li class="chapter" data-level="7.2" data-path="measurement-missing-data-and-selection-bias.html"><a href="measurement-missing-data-and-selection-bias.html#non-causal-diagrams"><i class="fa fa-check"></i><b>7.2</b> Non-Causal Diagrams</a></li>
<li class="chapter" data-level="7.3" data-path="measurement-missing-data-and-selection-bias.html"><a href="measurement-missing-data-and-selection-bias.html#publication-bias-and-p-hacking"><i class="fa fa-check"></i><b>7.3</b> Publication Bias and P-Hacking</a></li>
<li class="chapter" data-level="7.4" data-path="measurement-missing-data-and-selection-bias.html"><a href="measurement-missing-data-and-selection-bias.html#over--and-mis-interpretation-of-statistical-analyses"><i class="fa fa-check"></i><b>7.4</b> Over- and Mis-Interpretation of Statistical Analyses</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="from-identification-to-estimation.html"><a href="from-identification-to-estimation.html"><i class="fa fa-check"></i><b>8</b> From Identification to Estimation</a>
<ul>
<li class="chapter" data-level="8.1" data-path="from-identification-to-estimation.html"><a href="from-identification-to-estimation.html#identification-and-estimation"><i class="fa fa-check"></i><b>8.1</b> Identification and Estimation</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="systems-thinking-and-policy-translation.html"><a href="systems-thinking-and-policy-translation.html"><i class="fa fa-check"></i><b>9</b> Systems Thinking and Policy Translation</a></li>
<li class="chapter" data-level="10" data-path="final-project-presentations.html"><a href="final-project-presentations.html"><i class="fa fa-check"></i><b>10</b> Final Project Presentations</a></li>
<li class="divider"></li>
<li><a href="https://www.falcobargaglistoffi.com/" target="blank">Instructor: Falco J. Bargagli-Stoffi</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="foundations-of-causal-thinking-in-public-health" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">1</span> Foundations of Causal Thinking in Public Health<a href="foundations-of-causal-thinking-in-public-health.html#foundations-of-causal-thinking-in-public-health" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<blockquote>
<h2 id="class-materials" class="hasAnchor">Class materials<a href="foundations-of-causal-thinking-in-public-health.html#class-materials" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Slides: <a href="https://drive.google.com/file/d/1ujOsEenrQy1sjIX4Zt_CfAqeF0o-KfY-/view?usp=sharing"><strong>Module 1</strong></a></p>
<p>Recording: <a href="https://drive.google.com/file/d/14yxdT8so1w2LQV2pwoGm1ys3Ek5yuLET/view?usp=sharing"><strong>Module 1, Part 1.1</strong></a></p>
<p>Recording: <a href="https://drive.google.com/file/d/1rUQnbOTkVk5DPu8Ghbu2W80NJ008Auyt/view?usp=sharing"><strong>Module 1, Part 2.1</strong></a></p>
<p>Recording: <a href="https://drive.google.com/file/d/1hsA1CZ0jpVycsNmuH0A7C5AHmlvBpOvM/view?usp=sharing"><strong>Module 1, Part 2.2</strong></a></p>
</blockquote>
<blockquote>
<h2 id="textbook-reading" class="hasAnchor">Textbook reading<a href="foundations-of-causal-thinking-in-public-health.html#textbook-reading" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://static1.squarespace.com/static/675db8b0dd37046447128f5f/t/677676888e31cc50c2c33877/1735816881944/hernanrobins_WhatIf_2jan25.pdf"><strong>Hernán &amp; Robins, Causal Inference: What If – Chapters 1–2</strong></a></p>
</blockquote>
<blockquote>
<h2 id="supplementary-reading" class="hasAnchor">Supplementary reading<a href="foundations-of-causal-thinking-in-public-health.html#supplementary-reading" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://bayes.cs.ucla.edu/WHY/why-ch1.pdf"><strong>Pearl, J. and Mackenzie, D. (2018) The Book of Why: The New Science of Cause and Effect. Basic Books.</strong></a> Selected public health news articles (provided on the course site).</p>
</blockquote>
<blockquote>
<h2 id="topics-covered" class="hasAnchor">Topics covered<a href="foundations-of-causal-thinking-in-public-health.html#topics-covered" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Association vs. Causation<br />
</li>
<li>Introduction to Counterfactuals and Potential Outcomes<br />
</li>
<li>Causal Estimands and Identification<br />
</li>
<li>Critical reading exercise: analyzing causal claims in public health news</li>
</ul>
</blockquote>
<div id="association-vs.-causation" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Association vs. Causation<a href="foundations-of-causal-thinking-in-public-health.html#association-vs.-causation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Association</strong> refers to a statistical relationship where two variables move together, but one doesn’t necessarily cause the other. For instance, ice cream sales and drowning incidents both rise in the summer, not because one causes the other, but because they share a third factor: temperature. In contrast, <strong>causation</strong> implies a direct cause-and-effect relationship, where changing one variable leads to changes in another. Establishing causation requires rigorous methods, such as randomized controlled trials, to rule out confounding factors.</p>
<p><strong>Simpson’s Paradox</strong> occurs when a trend appears in separate groups but reverses when the data are combined. This paradox is driven by confounding variables—unaccounted factors that influence both the treatment and the outcome. It illustrates how aggregated data can be misleading and emphasizes the importance of analyzing relationships within subgroups to avoid drawing incorrect conclusions.</p>
<p>To demonstrate this paradox, I simulated a study comparing two pneumonia treatments across 2,000 trials. Treatment A was mostly given to mild cases, while Treatment B was given to severe cases. When data were analyzed without considering severity, Treatment A seemed more effective. However, when stratified by severity, Treatment B consistently showed lower death rates in both mild and severe groups. This was visualized through two plots: one showing the misleading overall trend, and another stratified by severity revealing the true relationship. A regression model with an interaction term confirmed that treatment effectiveness depends on disease severity, exemplifying Simpson’s Paradox.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-2"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-3"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-4" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">2050</span></span>
<span id="cb5-5"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-5" tabindex="-1"></a></span>
<span id="cb5-6"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-6" tabindex="-1"></a>severity <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Mild&quot;</span>, <span class="st">&quot;Severe&quot;</span>), <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">1450</span>, <span class="dv">600</span>))</span>
<span id="cb5-7"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-8" tabindex="-1"></a>treatment <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;Treatment A&quot;</span>, <span class="dv">1400</span>), <span class="fu">rep</span>(<span class="st">&quot;Treatment B&quot;</span>, <span class="dv">50</span>), </span>
<span id="cb5-9"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-9" tabindex="-1"></a>               <span class="fu">rep</span>(<span class="st">&quot;Treatment A&quot;</span>, <span class="dv">100</span>), <span class="fu">rep</span>(<span class="st">&quot;Treatment B&quot;</span>, <span class="dv">500</span>)) </span>
<span id="cb5-10"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-10" tabindex="-1"></a></span>
<span id="cb5-11"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-11" tabindex="-1"></a>outcome <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rbinom</span>(<span class="dv">1400</span>, <span class="dv">1</span>, <span class="fl">0.15</span>),  <span class="co"># Mild + A (15% death rate)</span></span>
<span id="cb5-12"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-12" tabindex="-1"></a>             <span class="fu">rbinom</span>(<span class="dv">50</span>, <span class="dv">1</span>, <span class="fl">0.10</span>),    <span class="co"># Mild + B (10% death rate)</span></span>
<span id="cb5-13"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-13" tabindex="-1"></a>             <span class="fu">rbinom</span>(<span class="dv">100</span>, <span class="dv">1</span>, <span class="fl">0.30</span>),   <span class="co"># Severe + A (30% death rate)</span></span>
<span id="cb5-14"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-14" tabindex="-1"></a>             <span class="fu">rbinom</span>(<span class="dv">500</span>, <span class="dv">1</span>, <span class="fl">0.20</span>))   <span class="co"># Severe + B (20% death rate)</span></span>
<span id="cb5-15"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-15" tabindex="-1"></a></span>
<span id="cb5-16"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-16" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb5-17"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-17" tabindex="-1"></a>  <span class="at">Severity =</span> severity,</span>
<span id="cb5-18"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-18" tabindex="-1"></a>  <span class="at">Treatment =</span> treatment,</span>
<span id="cb5-19"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-19" tabindex="-1"></a>  <span class="at">Outcome =</span> outcome</span>
<span id="cb5-20"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-20" tabindex="-1"></a>)</span>
<span id="cb5-21"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-21" tabindex="-1"></a></span>
<span id="cb5-22"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-22" tabindex="-1"></a>death_counts <span class="ot">&lt;-</span> <span class="fu">tapply</span>(df<span class="sc">$</span>Outcome, <span class="fu">list</span>(df<span class="sc">$</span>Severity, df<span class="sc">$</span>Treatment), sum)</span>
<span id="cb5-23"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-23" tabindex="-1"></a>table_counts <span class="ot">&lt;-</span> <span class="fu">table</span>(df<span class="sc">$</span>Severity, df<span class="sc">$</span>Treatment)</span>
<span id="cb5-24"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-24" tabindex="-1"></a>death_rates <span class="ot">&lt;-</span> <span class="fu">round</span>(death_counts <span class="sc">/</span> table_counts, <span class="dv">3</span>)</span>
<span id="cb5-25"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-25" tabindex="-1"></a></span>
<span id="cb5-26"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-26" tabindex="-1"></a>overall_a <span class="ot">&lt;-</span> <span class="fu">sum</span>(df<span class="sc">$</span>Outcome[df<span class="sc">$</span>Treatment <span class="sc">==</span> <span class="st">&quot;Treatment A&quot;</span>]) <span class="sc">/</span> <span class="fu">sum</span>(df<span class="sc">$</span>Treatment <span class="sc">==</span> <span class="st">&quot;Treatment A&quot;</span>)</span>
<span id="cb5-27"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-27" tabindex="-1"></a>overall_b <span class="ot">&lt;-</span> <span class="fu">sum</span>(df<span class="sc">$</span>Outcome[df<span class="sc">$</span>Treatment <span class="sc">==</span> <span class="st">&quot;Treatment B&quot;</span>]) <span class="sc">/</span> <span class="fu">sum</span>(df<span class="sc">$</span>Treatment <span class="sc">==</span> <span class="st">&quot;Treatment B&quot;</span>)</span>
<span id="cb5-28"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-28" tabindex="-1"></a></span>
<span id="cb5-29"><a href="foundations-of-causal-thinking-in-public-health.html#cb5-29" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;Death rates by severity and treatment:&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Death rates by severity and treatment:&quot;</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb7-1" tabindex="-1"></a><span class="fu">print</span>(death_rates)</span></code></pre></div>
<pre><code>##        Treatment A Treatment B
## Mild         0.116       0.080
## Severe       0.310       0.188</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb9-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Overall death rate (Treatment A):&quot;</span>, <span class="fu">round</span>(overall_a, <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Overall death rate (Treatment A): 0.129</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb11-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Overall death rate (Treatment B):&quot;</span>, <span class="fu">round</span>(overall_b, <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Overall death rate (Treatment B): 0.178</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-1" tabindex="-1"></a><span class="fu">suppressWarnings</span>({</span>
<span id="cb13-2"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-2" tabindex="-1"></a>  overall_plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb13-3"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-3" tabindex="-1"></a>    <span class="at">X_Pos =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">each =</span> n), </span>
<span id="cb13-4"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-4" tabindex="-1"></a>    <span class="at">Death_rate =</span> <span class="fu">c</span>(<span class="fu">rep</span>(overall_a, n), <span class="fu">rep</span>(overall_b, n)),  </span>
<span id="cb13-5"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-5" tabindex="-1"></a>    <span class="at">Treatment =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Treatment A&quot;</span>, <span class="st">&quot;Treatment B&quot;</span>), <span class="at">each =</span> n)</span>
<span id="cb13-6"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-6" tabindex="-1"></a>  )</span>
<span id="cb13-7"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-7" tabindex="-1"></a>  </span>
<span id="cb13-8"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-8" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(overall_plot_data, <span class="fu">aes</span>(<span class="at">x =</span> X_Pos, <span class="at">y =</span> Death_rate, </span>
<span id="cb13-9"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-9" tabindex="-1"></a>                                      <span class="at">color =</span> Treatment)) <span class="sc">+</span></span>
<span id="cb13-10"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-10" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.05</span>), </span>
<span id="cb13-11"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-11" tabindex="-1"></a>               <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb13-12"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-12" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">2</span>, <span class="at">y =</span> overall_a, <span class="at">yend =</span> overall_b), </span>
<span id="cb13-13"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-13" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  </span>
<span id="cb13-14"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-14" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), </span>
<span id="cb13-15"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-15" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Treatment A&quot;</span>, <span class="st">&quot;Treatment B&quot;</span>)) <span class="sc">+</span></span>
<span id="cb13-16"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-16" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Treatment A&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="cb13-17"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-17" tabindex="-1"></a>                                  <span class="st">&quot;Treatment B&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb13-18"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-18" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Overall Trend (Simpson&#39;s Paradox)&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb13-19"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-19" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;Risk of Death&quot;</span>)</span>
<span id="cb13-20"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-20" tabindex="-1"></a>  </span>
<span id="cb13-21"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-21" tabindex="-1"></a>  <span class="fu">print</span>(p1)</span>
<span id="cb13-22"><a href="foundations-of-causal-thinking-in-public-health.html#cb13-22" tabindex="-1"></a>})</span></code></pre></div>
<p><img src="Causal-Inference-Graduate_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-1" tabindex="-1"></a><span class="co"># Calculate death rates for each severity and treatment</span></span>
<span id="cb14-2"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-2" tabindex="-1"></a>rate11 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Severity <span class="sc">==</span> <span class="st">&quot;Mild&quot;</span>, Treatment <span class="sc">==</span> <span class="st">&quot;Treatment A&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Outcome)</span>
<span id="cb14-3"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-3" tabindex="-1"></a>rate12 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Severity <span class="sc">==</span> <span class="st">&quot;Mild&quot;</span>, Treatment <span class="sc">==</span> <span class="st">&quot;Treatment B&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Outcome)</span>
<span id="cb14-4"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-4" tabindex="-1"></a>rate21 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Severity <span class="sc">==</span> <span class="st">&quot;Severe&quot;</span>, Treatment <span class="sc">==</span> <span class="st">&quot;Treatment A&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Outcome)</span>
<span id="cb14-5"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-5" tabindex="-1"></a>rate22 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Severity <span class="sc">==</span> <span class="st">&quot;Severe&quot;</span>, Treatment <span class="sc">==</span> <span class="st">&quot;Treatment B&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Outcome)</span>
<span id="cb14-6"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-6" tabindex="-1"></a></span>
<span id="cb14-7"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-7" tabindex="-1"></a><span class="co"># Prepare the data for plotting</span></span>
<span id="cb14-8"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-8" tabindex="-1"></a>data_by_severity <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb14-9"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-9" tabindex="-1"></a>  <span class="at">X_Pos =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">each =</span> n),</span>
<span id="cb14-10"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-10" tabindex="-1"></a>  <span class="at">Death_rate =</span> <span class="fu">c</span>(rate11, rate12, rate21, rate22),</span>
<span id="cb14-11"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-11" tabindex="-1"></a>  <span class="at">Group =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Mild - A&quot;</span>, <span class="st">&quot;Mild - B&quot;</span>, <span class="st">&quot;Severe - A&quot;</span>, <span class="st">&quot;Severe - B&quot;</span>), </span>
<span id="cb14-12"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-12" tabindex="-1"></a>              <span class="at">each =</span> n),</span>
<span id="cb14-13"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-13" tabindex="-1"></a>  <span class="at">Severity =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Mild&quot;</span>, <span class="st">&quot;Mild&quot;</span>, <span class="st">&quot;Severe&quot;</span>, <span class="st">&quot;Severe&quot;</span>), <span class="at">each =</span> n)</span>
<span id="cb14-14"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-14" tabindex="-1"></a>)</span>
<span id="cb14-15"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-15" tabindex="-1"></a></span>
<span id="cb14-16"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-16" tabindex="-1"></a><span class="co"># Create the plot with proper jittering and smooth lines</span></span>
<span id="cb14-17"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-17" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data_by_severity, <span class="fu">aes</span>(<span class="at">x =</span> X_Pos, <span class="at">y =</span> Death_rate, <span class="at">color =</span> Group)) <span class="sc">+</span></span>
<span id="cb14-18"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-18" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">height =</span> <span class="fl">0.05</span>), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span>  <span class="co"># Jitter both horizontally and vertically</span></span>
<span id="cb14-19"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-19" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> <span class="fu">subset</span>(data_by_severity, Severity <span class="sc">==</span> <span class="st">&quot;Mild&quot;</span>), </span>
<span id="cb14-20"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-20" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="fu">aes</span>(<span class="at">group =</span> Severity)) <span class="sc">+</span>  </span>
<span id="cb14-21"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-21" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> <span class="fu">subset</span>(data_by_severity, Severity <span class="sc">==</span> <span class="st">&quot;Severe&quot;</span>), </span>
<span id="cb14-22"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-22" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="fu">aes</span>(<span class="at">group =</span> Severity)) <span class="sc">+</span>  </span>
<span id="cb14-23"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-23" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, </span>
<span id="cb14-24"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-24" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Mild - A&quot;</span>, <span class="st">&quot;Mild - B&quot;</span>, <span class="st">&quot;Severe - A&quot;</span>, <span class="st">&quot;Severe - B&quot;</span>)) <span class="sc">+</span></span>
<span id="cb14-25"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-25" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Mild - A&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>, <span class="st">&quot;Mild - B&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>, </span>
<span id="cb14-26"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-26" tabindex="-1"></a>                                <span class="st">&quot;Severe - A&quot;</span> <span class="ot">=</span> <span class="st">&quot;darkred&quot;</span>, </span>
<span id="cb14-27"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-27" tabindex="-1"></a>                                <span class="st">&quot;Severe - B&quot;</span> <span class="ot">=</span> <span class="st">&quot;darkblue&quot;</span>)) <span class="sc">+</span></span>
<span id="cb14-28"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-28" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Risk by Severity (Mild vs. Severe)&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb14-29"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-29" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Risk of Death&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-30"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-30" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-31"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-31" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">&quot;none&quot;</span>)  <span class="co"># Removing the legend for clarity</span></span>
<span id="cb14-32"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-32" tabindex="-1"></a></span>
<span id="cb14-33"><a href="foundations-of-causal-thinking-in-public-health.html#cb14-33" tabindex="-1"></a><span class="fu">print</span>(p2)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;
## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="Causal-Inference-Graduate_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p><strong>Step 4: Fit Regression Model to Test for Interaction</strong></p>
<ul>
<li>Fitted a linear model to estimate how treatment and severity affect death risk<br />
</li>
<li>Graphed if there’s an interaction between them</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb16-1" tabindex="-1"></a>regression_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-2"><a href="foundations-of-causal-thinking-in-public-health.html#cb16-2" tabindex="-1"></a>  <span class="at">Death_rate =</span> <span class="fu">c</span>(rate11, rate12, rate21, rate22),</span>
<span id="cb16-3"><a href="foundations-of-causal-thinking-in-public-health.html#cb16-3" tabindex="-1"></a>  <span class="at">Treatment =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">each =</span> n),</span>
<span id="cb16-4"><a href="foundations-of-causal-thinking-in-public-health.html#cb16-4" tabindex="-1"></a>  <span class="at">Severity =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">each =</span> n)</span>
<span id="cb16-5"><a href="foundations-of-causal-thinking-in-public-health.html#cb16-5" tabindex="-1"></a>)</span>
<span id="cb16-6"><a href="foundations-of-causal-thinking-in-public-health.html#cb16-6" tabindex="-1"></a></span>
<span id="cb16-7"><a href="foundations-of-causal-thinking-in-public-health.html#cb16-7" tabindex="-1"></a>regression_data<span class="sc">$</span>Interaction <span class="ot">&lt;-</span> regression_data<span class="sc">$</span>Treatment <span class="sc">*</span> </span>
<span id="cb16-8"><a href="foundations-of-causal-thinking-in-public-health.html#cb16-8" tabindex="-1"></a>  regression_data<span class="sc">$</span>Severity</span>
<span id="cb16-9"><a href="foundations-of-causal-thinking-in-public-health.html#cb16-9" tabindex="-1"></a></span>
<span id="cb16-10"><a href="foundations-of-causal-thinking-in-public-health.html#cb16-10" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(Death_rate <span class="sc">~</span> Treatment <span class="sc">+</span> Severity <span class="sc">+</span> Interaction, </span>
<span id="cb16-11"><a href="foundations-of-causal-thinking-in-public-health.html#cb16-11" tabindex="-1"></a>            <span class="at">data =</span> regression_data)</span>
<span id="cb16-12"><a href="foundations-of-causal-thinking-in-public-health.html#cb16-12" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Death_rate ~ Treatment + Severity + Interaction, 
##     data = regression_data)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -0.142 -0.142 -0.142 -0.142  0.858 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1.420e-01  7.710e-03   18.41   &lt;2e-16 ***
## Treatment   -1.104e-15  1.090e-02    0.00        1    
## Severity    -1.108e-15  1.090e-02    0.00        1    
## Interaction  9.569e-16  1.542e-02    0.00        1    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3491 on 8196 degrees of freedom
## Multiple R-squared:  1.907e-29,  Adjusted R-squared:  -0.000366 
## F-statistic: 5.209e-26 on 3 and 8196 DF,  p-value: 1</code></pre>
</div>
<div id="introduction-to-counterfactuals-and-potential-outcomes" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Introduction to Counterfactuals and Potential Outcomes<a href="foundations-of-causal-thinking-in-public-health.html#introduction-to-counterfactuals-and-potential-outcomes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>At the heart of causal inference lies a simple yet powerful idea: counterfactuals — what would have happened if something else had occurred. To formalize this, the Potential Outcomes Framework defines two outcomes for each individual:</p>
<p>Y(1): The outcome if the individual receives the treatment<br />
Y(0): The outcome if the individual does not receive the treatment<br />
The causal effect for an individual is the difference: τi = Yi(1) − Yi(0)</p>
<p>But here’s the catch: we can never observe both outcomes for the same person. This is known as the Fundamental Problem of Causal Inference. We only observe the outcome under the condition that actually occurred — everything else is unobserved, or counterfactual.</p>
<p>As shown in the Simpson’s Paradox example above, failing to account for confounding variables can lead to conclusions that completely misrepresent the true causal effect. When we simply compare outcomes between treated and untreated groups without considering differences in their underlying characteristics (like disease severity), we risk attributing differences to the treatment that are actually due to selection bias. By thinking in terms of potential outcomes — what would have happened under treatment vs. no treatment — we can see how causal claims require more than just association. This framework makes clear that understanding the data-generating process is critical, and it motivates the need for methods that can uncover hidden structure in the data.</p>
<p>While the average treatment effect (ATE) helps summarize the overall impact of a treatment, it often masks important variation across individuals. In practice, not everyone responds to treatment the same way — some benefit more than others, and some may even be harmed. This brings us to the concept of the Individual Treatment Effect (ITE), which asks: what was the treatment effect for this specific person? Although we can never observe both potential outcomes for a single individual, we can use modeling techniques to estimate ITEs and explore treatment effect heterogeneity. The following example demonstrates how this was done using simulated data.</p>
<p><strong>Individual Treatment Effect (ITE)</strong></p>
<p>In causal inference, the <strong>Individual Treatment Effect</strong> (ITE) measures how much one specific patient benefits from a treatment. ITE focuses on personalized benefits - how much an intervention would change the outcome for each person at the same time. The formula for the ITE is Yi(1) - Yi(0), where Yi(1) is the outcome if the person receives the treatment while Yi(0) is the outcome if the person does not receive the treatment.</p>
<p>A fundamental problem in causal inference is that we can never observe both Yi(1) and Yi(0) for the same person, because each person either receives the treatment or does not, meaning one of the outcomes is missing. This is known as the fundamental problem of causal inference, and because of this, we use statistical methodologies and machine learning techniques to estimate ITE.</p>
<p>To do this, I simulated healthcare data.</p>
<p><strong>Simulating the Patient Data</strong></p>
<ul>
<li>Simulated 2,000 individuals, each with baseline characteristics: age, BMI, and cholesterol.<br />
</li>
<li>Treatment assignment is based on a model where older individuals with higher cholesterol are more likely to receive treatment.<br />
</li>
<li>Generated two potential outcomes for each individual: Y(0) (if untreated) and Y(1) (if treated).<br />
</li>
<li>The observed outcome depends on whether each person actually received treatment or not.<br />
</li>
<li>Calculated the true individual treatment effect (ITE) as the difference between Y(1) and Y(0).</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-1" tabindex="-1"></a><span class="co"># Simulate data for 2,000 individuals</span></span>
<span id="cb18-2"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb18-3"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-3" tabindex="-1"></a></span>
<span id="cb18-4"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-4" tabindex="-1"></a><span class="co"># Generate baseline covariates (age, BMI, cholesterol)</span></span>
<span id="cb18-5"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-5" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>)           </span>
<span id="cb18-6"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-6" tabindex="-1"></a><span class="co"># Normally distributed age centered around 50</span></span>
<span id="cb18-7"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-7" tabindex="-1"></a>bmi <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">25</span>, <span class="at">sd =</span> <span class="dv">4</span>)            </span>
<span id="cb18-8"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-8" tabindex="-1"></a><span class="co"># BMI centered around 25</span></span>
<span id="cb18-9"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-9" tabindex="-1"></a>cholesterol <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">200</span>, <span class="at">sd =</span> <span class="dv">30</span>)  </span>
<span id="cb18-10"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-10" tabindex="-1"></a><span class="co"># Cholesterol centered around 200</span></span>
<span id="cb18-11"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-11" tabindex="-1"></a></span>
<span id="cb18-12"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-12" tabindex="-1"></a><span class="co"># Simulate treatment assignment using logistic regression:</span></span>
<span id="cb18-13"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-13" tabindex="-1"></a><span class="co"># Older individuals with higher cholesterol are more likely to be treated</span></span>
<span id="cb18-14"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-14" tabindex="-1"></a>treatment <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fu">plogis</span>(<span class="fl">0.05</span> <span class="sc">*</span> age <span class="sc">+</span> <span class="fl">0.01</span> <span class="sc">*</span> cholesterol <span class="sc">-</span> <span class="dv">2</span>))</span>
<span id="cb18-15"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-15" tabindex="-1"></a></span>
<span id="cb18-16"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-16" tabindex="-1"></a><span class="co"># Simulate potential outcome without treatment (Y(0))</span></span>
<span id="cb18-17"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-17" tabindex="-1"></a><span class="co"># Outcome depends on age, BMI, and cholesterol plus random noise</span></span>
<span id="cb18-18"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-18" tabindex="-1"></a>y_0 <span class="ot">&lt;-</span> <span class="dv">140</span> <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">*</span> age <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> bmi <span class="sc">+</span> <span class="fl">0.2</span> <span class="sc">*</span> cholesterol <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">sd =</span> <span class="dv">5</span>)</span>
<span id="cb18-19"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-19" tabindex="-1"></a></span>
<span id="cb18-20"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-20" tabindex="-1"></a><span class="co"># Simulate potential outcome with treatment (Y(1))</span></span>
<span id="cb18-21"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-21" tabindex="-1"></a><span class="co"># Treatment effect varies with age and cholesterol and adds its own noise</span></span>
<span id="cb18-22"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-22" tabindex="-1"></a>y_1 <span class="ot">&lt;-</span> y_0 <span class="sc">-</span> (<span class="dv">40</span> <span class="sc">+</span> <span class="fl">1.0</span> <span class="sc">*</span> age <span class="sc">-</span> <span class="fl">0.3</span> <span class="sc">*</span> cholesterol) <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">sd =</span> <span class="fl">1.5</span>)</span>
<span id="cb18-23"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-23" tabindex="-1"></a></span>
<span id="cb18-24"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-24" tabindex="-1"></a><span class="co"># Observed outcome: if treated, observe Y(1); otherwise, observe Y(0)</span></span>
<span id="cb18-25"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-25" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(treatment <span class="sc">==</span> <span class="dv">1</span>, y_1, y_0)</span>
<span id="cb18-26"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-26" tabindex="-1"></a></span>
<span id="cb18-27"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-27" tabindex="-1"></a><span class="co"># Calculate the true Individual Treatment Effect (ITE)</span></span>
<span id="cb18-28"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-28" tabindex="-1"></a>true_ite <span class="ot">&lt;-</span> y_1 <span class="sc">-</span> y_0  <span class="co"># Difference between potential outcomes for each person</span></span>
<span id="cb18-29"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-29" tabindex="-1"></a></span>
<span id="cb18-30"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-30" tabindex="-1"></a><span class="co"># Combine into a data frame for analysis</span></span>
<span id="cb18-31"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-31" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb18-32"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-32" tabindex="-1"></a>  age,</span>
<span id="cb18-33"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-33" tabindex="-1"></a>  bmi,</span>
<span id="cb18-34"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-34" tabindex="-1"></a>  cholesterol,</span>
<span id="cb18-35"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-35" tabindex="-1"></a>  treatment,</span>
<span id="cb18-36"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-36" tabindex="-1"></a>  y,           <span class="co"># observed outcome</span></span>
<span id="cb18-37"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-37" tabindex="-1"></a>  true_ite     <span class="co"># the true (unobserved) individual causal effect</span></span>
<span id="cb18-38"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-38" tabindex="-1"></a>)</span>
<span id="cb18-39"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-39" tabindex="-1"></a></span>
<span id="cb18-40"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-40" tabindex="-1"></a><span class="co"># Preview the first few rows of the dataset</span></span>
<span id="cb18-41"><a href="foundations-of-causal-thinking-in-public-health.html#cb18-41" tabindex="-1"></a><span class="fu">head</span>(data)</span></code></pre></div>
<pre><code>##        age      bmi cholesterol treatment         y  true_ite
## 1 59.09336 27.59360    197.5519         1 109.89198 -38.47166
## 2 50.12370 18.73318    189.3397         1 127.55453 -31.34194
## 3 52.15306 20.49743    219.8410         1 126.55925 -27.68562
## 4 53.94252 20.24831    144.5960         1  99.59211 -52.15800
## 5 36.91065 24.44705    205.2673         1 152.28678 -14.90954
## 6 43.74325 32.36804    156.7873         1 122.31924 -36.30009</code></pre>
<p>Next, I estimated treatment effects using regression. Since I can’t observe both Y(0) and Y(1) for any individual, I used separate regressions for treatment and control groups. I used the models to predict counter factual outcomes for all patients and to compute the estimated ITE as the difference between Y(1) and Y(0).</p>
<p><strong>Estimate Treatment Effects Using Regression</strong></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb20-1" tabindex="-1"></a>control_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> age <span class="sc">+</span> bmi <span class="sc">+</span> cholesterol, <span class="at">data =</span> data, </span>
<span id="cb20-2"><a href="foundations-of-causal-thinking-in-public-health.html#cb20-2" tabindex="-1"></a>                    <span class="at">subset =</span> (treatment <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb20-3"><a href="foundations-of-causal-thinking-in-public-health.html#cb20-3" tabindex="-1"></a>treatment_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> age <span class="sc">+</span> bmi <span class="sc">+</span> cholesterol, <span class="at">data =</span> data, </span>
<span id="cb20-4"><a href="foundations-of-causal-thinking-in-public-health.html#cb20-4" tabindex="-1"></a>                      <span class="at">subset =</span> (treatment <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb20-5"><a href="foundations-of-causal-thinking-in-public-health.html#cb20-5" tabindex="-1"></a></span>
<span id="cb20-6"><a href="foundations-of-causal-thinking-in-public-health.html#cb20-6" tabindex="-1"></a>data<span class="sc">$</span>y0_hat <span class="ot">&lt;-</span> <span class="fu">predict</span>(control_model, <span class="at">newdata =</span> data) </span>
<span id="cb20-7"><a href="foundations-of-causal-thinking-in-public-health.html#cb20-7" tabindex="-1"></a>data<span class="sc">$</span>y1_hat <span class="ot">&lt;-</span> <span class="fu">predict</span>(treatment_model, <span class="at">newdata =</span> data) </span>
<span id="cb20-8"><a href="foundations-of-causal-thinking-in-public-health.html#cb20-8" tabindex="-1"></a></span>
<span id="cb20-9"><a href="foundations-of-causal-thinking-in-public-health.html#cb20-9" tabindex="-1"></a>data<span class="sc">$</span>ite_estimate <span class="ot">&lt;-</span> data<span class="sc">$</span>y1_hat <span class="sc">-</span> data<span class="sc">$</span>y0_hat</span>
<span id="cb20-10"><a href="foundations-of-causal-thinking-in-public-health.html#cb20-10" tabindex="-1"></a></span>
<span id="cb20-11"><a href="foundations-of-causal-thinking-in-public-health.html#cb20-11" tabindex="-1"></a><span class="fu">head</span>(data[<span class="fu">c</span>(<span class="st">&quot;ite_estimate&quot;</span>, <span class="st">&quot;y0_hat&quot;</span>, <span class="st">&quot;y1_hat&quot;</span>)])</span></code></pre></div>
<pre><code>##   ite_estimate   y0_hat    y1_hat
## 1    -39.17579 157.4554 118.27956
## 2    -33.58145 158.3584 124.77697
## 3    -26.50701 163.9585 137.45146
## 4    -50.26463 147.5878  97.32317
## 5    -15.35841 169.7268 154.36835
## 6    -35.48908 158.1105 122.62139</code></pre>
<p>Now, I plotted the true ITE vs the estimated ITE. Here, each point is a patient, and the red dashed line represents the ideal estimation. If the point fits well with the line, then the model is accurate.</p>
<p><strong>Visualizing the Estimated ITE</strong></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb22-1" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb22-2"><a href="foundations-of-causal-thinking-in-public-health.html#cb22-2" tabindex="-1"></a></span>
<span id="cb22-3"><a href="foundations-of-causal-thinking-in-public-health.html#cb22-3" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> true_ite, <span class="at">y =</span> ite_estimate)) <span class="sc">+</span> </span>
<span id="cb22-4"><a href="foundations-of-causal-thinking-in-public-health.html#cb22-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb22-5"><a href="foundations-of-causal-thinking-in-public-health.html#cb22-5" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span> </span>
<span id="cb22-6"><a href="foundations-of-causal-thinking-in-public-health.html#cb22-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Estimated ITE vs True ITE (Blood Pressure Reduction)&quot;</span>,</span>
<span id="cb22-7"><a href="foundations-of-causal-thinking-in-public-health.html#cb22-7" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;True ITE&quot;</span>,</span>
<span id="cb22-8"><a href="foundations-of-causal-thinking-in-public-health.html#cb22-8" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">&quot;Estimated ITE&quot;</span>)</span></code></pre></div>
<p><img src="Causal-Inference-Graduate_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p><strong>Visualizing the Esimated ITE Without Looking at Confounding</strong></p>
<ul>
<li>Estimated average potential outcomes without adjusting for covariates.<br />
</li>
<li>Filled in predicted values based on group averages.</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb23-1" tabindex="-1"></a>y0_hat_simple <span class="ot">&lt;-</span> <span class="fu">mean</span>(data<span class="sc">$</span>y[data<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">0</span>])  </span>
<span id="cb23-2"><a href="foundations-of-causal-thinking-in-public-health.html#cb23-2" tabindex="-1"></a>y1_hat_simple <span class="ot">&lt;-</span> <span class="fu">mean</span>(data<span class="sc">$</span>y[data<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">1</span>])  </span>
<span id="cb23-3"><a href="foundations-of-causal-thinking-in-public-health.html#cb23-3" tabindex="-1"></a></span>
<span id="cb23-4"><a href="foundations-of-causal-thinking-in-public-health.html#cb23-4" tabindex="-1"></a>data<span class="sc">$</span>y0_hat_simple <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">1</span>, y0_hat_simple, data<span class="sc">$</span>y)  </span>
<span id="cb23-5"><a href="foundations-of-causal-thinking-in-public-health.html#cb23-5" tabindex="-1"></a>data<span class="sc">$</span>y1_hat_simple <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">0</span>, y1_hat_simple, data<span class="sc">$</span>y)  </span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb24-1" tabindex="-1"></a>data<span class="sc">$</span>ite_estimate_simple <span class="ot">&lt;-</span> data<span class="sc">$</span>y1_hat_simple <span class="sc">-</span> data<span class="sc">$</span>y0_hat_simple</span>
<span id="cb24-2"><a href="foundations-of-causal-thinking-in-public-health.html#cb24-2" tabindex="-1"></a></span>
<span id="cb24-3"><a href="foundations-of-causal-thinking-in-public-health.html#cb24-3" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> true_ite, <span class="at">y =</span> ite_estimate_simple)) <span class="sc">+</span> </span>
<span id="cb24-4"><a href="foundations-of-causal-thinking-in-public-health.html#cb24-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb24-5"><a href="foundations-of-causal-thinking-in-public-health.html#cb24-5" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span> </span>
<span id="cb24-6"><a href="foundations-of-causal-thinking-in-public-health.html#cb24-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Estimated ITE vs True ITE (No Confounder Adjustment)&quot;</span>,</span>
<span id="cb24-7"><a href="foundations-of-causal-thinking-in-public-health.html#cb24-7" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;True ITE&quot;</span>,</span>
<span id="cb24-8"><a href="foundations-of-causal-thinking-in-public-health.html#cb24-8" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Estimated ITE (Unadjusted)&quot;</span>) <span class="sc">+</span></span>
<span id="cb24-9"><a href="foundations-of-causal-thinking-in-public-health.html#cb24-9" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="Causal-Inference-Graduate_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Here are the top 10 patients who benefited the most from the treatment. This helps me identify patients who are most likely to benefit, as well as focus on individuals with high predicted response.</p>
<p><strong>Patients Who Benefit Most</strong></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb25-1" tabindex="-1"></a>top_beneficiaries <span class="ot">&lt;-</span> data[<span class="fu">order</span>(data<span class="sc">$</span>ite_estimate), ][<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ]</span>
<span id="cb25-2"><a href="foundations-of-causal-thinking-in-public-health.html#cb25-2" tabindex="-1"></a>top_beneficiaries[, <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;bmi&quot;</span>, <span class="st">&quot;cholesterol&quot;</span>, <span class="st">&quot;ite_estimate&quot;</span>)]</span></code></pre></div>
<pre><code>##           age      bmi cholesterol ite_estimate
## 1165 80.33482 25.13123    133.4620    -79.06324
## 616  66.41704 27.40510    113.6013    -70.92476
## 1987 76.36464 28.77438    149.1510    -70.21952
## 326  76.10334 22.30859    150.9641    -70.05255
## 1537 80.42694 28.70560    169.4516    -68.30319
## 931  79.44158 23.93230    169.1237    -67.88533
## 522  66.13431 25.17372    125.8576    -67.28147
## 1785 70.99804 24.95190    145.0172    -66.50295
## 1813 61.58360 28.65182    116.3598    -65.23527
## 1204 73.14319 21.83492    161.0429    -64.23728</code></pre>
</div>
<div id="causal-estimands-and-identification" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> Causal Estimands and Identification<a href="foundations-of-causal-thinking-in-public-health.html#causal-estimands-and-identification" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Causal estimands are the quantities we aim to estimate to understand the effect of a treatment or intervention. The most common estimands include:<br />
- Average Treatment Effect (ATE): Measures the average difference in outcomes if everyone received the treatment versus if no one did.<br />
- Average Treatment Effect on the Treated (ATT): Measures the effect of treatment for those who actually received the treatment.<br />
- Average Treatment Effect on the Controls (ATC): Measures the effect for those who did not receive the treatment.<br />
- Conditional Average Treatment Effect (CATE): Measures the treatment effect for subgroups defined by observed characteristics (e.g., older vs. younger patients).</p>
<p>Identification is the process of linking a causal estimand (like ATE) to observable data. Without valid identification, any estimates we produce may be biased or incorrect. One major challenge in causal inference is that we can never observe both potential outcomes for the same person — only the outcome under the actual treatment they received. This is the Fundamental Problem of Causal Inference.</p>
<p>To overcome this, we make assumptions (like unconfoundedness or selection on observables) and use statistical models to estimate the missing potential outcome.</p>
<p><strong>Conditional Average Treatment Effect (CATE)</strong></p>
<p>The Conditional Average Treatment Effect (CATE) represents the expected treatment effect for a specific subgroup of patients with a particular characteristic. Unlike the Average Treatment Effect (ATE), which measures the treatment’s effect on the entire population, CATE understands that the population is not homogeneous and conditions on certain variables (e.g. age, BMI, cholesterol). CATE can be described as E[Y(1) - Y(0) | X], where X is the observed characteristics. This allows researchers to see which groups benefit more or less from a treatment, which can in-turn affect future decisions.</p>
<p>For example, in clinical trials, a drug may work more effectively for older patients than younger ones. Another example would be a job program working more effectively on people with college degrees than people without college degrees. Estimating CATE allows business owners, researchers, and policymakers to make effective decisions that optimize outcomes for all groups.</p>
<p>To estimate CATE from observational data, I fitted separate predictive models for the treated and control groups and then computed the expected difference in outcomes for different subgroups. I estimated the CATE for age groups by splitting the data into younger individuals (age &lt; 40 years) and older individuals (age &gt;= 40 years) and then computing the average Individual Treatment Effect (ITE) within each group.</p>
<p><strong>Computing the Conditional Average Treatment Effect (CATE) for Age Groups</strong></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb27-1" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb27-2"><a href="foundations-of-causal-thinking-in-public-health.html#cb27-2" tabindex="-1"></a></span>
<span id="cb27-3"><a href="foundations-of-causal-thinking-in-public-health.html#cb27-3" tabindex="-1"></a>cate_young <span class="ot">&lt;-</span> <span class="fu">mean</span>(data<span class="sc">$</span>ite_estimate[data<span class="sc">$</span>age <span class="sc">&lt;</span> threshold])</span>
<span id="cb27-4"><a href="foundations-of-causal-thinking-in-public-health.html#cb27-4" tabindex="-1"></a>cate_old <span class="ot">&lt;-</span> <span class="fu">mean</span>(data<span class="sc">$</span>ite_estimate[data<span class="sc">$</span>age <span class="sc">&gt;=</span> threshold])</span></code></pre></div>
<p>Finally, I stored and display the CATE results.</p>
<p><strong>Store and Display CATE Results</strong></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb28-1" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb28-2"><a href="foundations-of-causal-thinking-in-public-health.html#cb28-2" tabindex="-1"></a>  <span class="at">age_group =</span> <span class="fu">c</span>(<span class="st">&quot;&lt; 40 years&quot;</span>, <span class="st">&quot;&gt;= 40 years&quot;</span>),</span>
<span id="cb28-3"><a href="foundations-of-causal-thinking-in-public-health.html#cb28-3" tabindex="-1"></a>  <span class="at">cate_estimate =</span> <span class="fu">c</span>(cate_young, cate_old)</span>
<span id="cb28-4"><a href="foundations-of-causal-thinking-in-public-health.html#cb28-4" tabindex="-1"></a>)</span>
<span id="cb28-5"><a href="foundations-of-causal-thinking-in-public-health.html#cb28-5" tabindex="-1"></a></span>
<span id="cb28-6"><a href="foundations-of-causal-thinking-in-public-health.html#cb28-6" tabindex="-1"></a><span class="fu">print</span>(results)</span></code></pre></div>
<pre><code>##     age_group cate_estimate
## 1  &lt; 40 years     -21.65116
## 2 &gt;= 40 years     -37.82581</code></pre>
<p>From the table, we can see that the CATE is more negative for older individuals, meaning that the treatment appears to be more effective for people older than 40. Because the CATE for younger individuals is lower, this means that the treatment is less effective for young people. This shows that age influences the effectiveness of the treatment. Here is a visualization of the CATE estimates.</p>
<p><strong>Visualization of the CATE Effects Based on Age</strong></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb30-1" tabindex="-1"></a>cate_young_se <span class="ot">&lt;-</span> <span class="fu">sd</span>(data<span class="sc">$</span>ite_estimate[data<span class="sc">$</span>age <span class="sc">&lt;</span> threshold]) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(data<span class="sc">$</span>age <span class="sc">&lt;</span> threshold))</span>
<span id="cb30-2"><a href="foundations-of-causal-thinking-in-public-health.html#cb30-2" tabindex="-1"></a>cate_old_se <span class="ot">&lt;-</span> <span class="fu">sd</span>(data<span class="sc">$</span>ite_estimate[data<span class="sc">$</span>age <span class="sc">&gt;=</span> threshold]) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(data<span class="sc">$</span>age <span class="sc">&gt;=</span> threshold))</span>
<span id="cb30-3"><a href="foundations-of-causal-thinking-in-public-health.html#cb30-3" tabindex="-1"></a></span>
<span id="cb30-4"><a href="foundations-of-causal-thinking-in-public-health.html#cb30-4" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb30-5"><a href="foundations-of-causal-thinking-in-public-health.html#cb30-5" tabindex="-1"></a>  <span class="at">age_group =</span> <span class="fu">c</span>(<span class="st">&quot;&lt; 50 years&quot;</span>, <span class="st">&quot;&gt;= 50 years&quot;</span>),</span>
<span id="cb30-6"><a href="foundations-of-causal-thinking-in-public-health.html#cb30-6" tabindex="-1"></a>  <span class="at">cate_estimate =</span> <span class="fu">c</span>(cate_young, cate_old),</span>
<span id="cb30-7"><a href="foundations-of-causal-thinking-in-public-health.html#cb30-7" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">c</span>(cate_young <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> cate_young_se, cate_old <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> cate_old_se),</span>
<span id="cb30-8"><a href="foundations-of-causal-thinking-in-public-health.html#cb30-8" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">c</span>(cate_young <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> cate_young_se, cate_old <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> cate_old_se)</span>
<span id="cb30-9"><a href="foundations-of-causal-thinking-in-public-health.html#cb30-9" tabindex="-1"></a>)</span>
<span id="cb30-10"><a href="foundations-of-causal-thinking-in-public-health.html#cb30-10" tabindex="-1"></a></span>
<span id="cb30-11"><a href="foundations-of-causal-thinking-in-public-health.html#cb30-11" tabindex="-1"></a><span class="fu">ggplot</span>(results, <span class="fu">aes</span>(<span class="at">y =</span> age_group, <span class="at">x =</span> cate_estimate)) <span class="sc">+</span></span>
<span id="cb30-12"><a href="foundations-of-causal-thinking-in-public-health.html#cb30-12" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span>  </span>
<span id="cb30-13"><a href="foundations-of-causal-thinking-in-public-health.html#cb30-13" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> lower, <span class="at">xmax =</span> upper), <span class="at">width =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span> </span>
<span id="cb30-14"><a href="foundations-of-causal-thinking-in-public-health.html#cb30-14" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span> </span>
<span id="cb30-15"><a href="foundations-of-causal-thinking-in-public-health.html#cb30-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Subgroup Analysis of Treatment Effect&quot;</span>,</span>
<span id="cb30-16"><a href="foundations-of-causal-thinking-in-public-health.html#cb30-16" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Conditional Average Treatment Effect (CATE)&quot;</span>,</span>
<span id="cb30-17"><a href="foundations-of-causal-thinking-in-public-health.html#cb30-17" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Age Group&quot;</span>) <span class="sc">+</span></span>
<span id="cb30-18"><a href="foundations-of-causal-thinking-in-public-health.html#cb30-18" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="Causal-Inference-Graduate_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p><strong>Average Treatment Effect (ATE)</strong></p>
<p>The <strong>Average Treatment Effect (ATE)</strong> represents the impact of a treatment or exposure across an entire population. It is the difference between the average outcome with treatment and the average outcome without treatment. ATE is expressed as E[Y(1)] - E[Y(0)] where Y(1) is the potential outcome if treated and Y(0) is the potential outcome if not treated. ATE measures the treatment’s effectiveness but it also assumes homogeneity between the two groups, meaning it doesn’t account for differences within the groups. In real-life, treatment effects can be mitigated or enhanced because of characteristics like age, income or gender, which is why the Conditional Average Treatment Effect (CATE) are used to study heterogeneity, or differences between the treated and non-treated groups.</p>
<p><strong>Computing the Average Treatment Effect</strong></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb31-1" tabindex="-1"></a>ate <span class="ot">&lt;-</span> <span class="fu">mean</span>(data<span class="sc">$</span>ite_estimate)</span>
<span id="cb31-2"><a href="foundations-of-causal-thinking-in-public-health.html#cb31-2" tabindex="-1"></a></span>
<span id="cb31-3"><a href="foundations-of-causal-thinking-in-public-health.html#cb31-3" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;The Average Treatment Effect (ATE) is&quot;</span>, <span class="fu">round</span>(ate, <span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;The Average Treatment Effect (ATE) is -29.81&quot;</code></pre>
<p>Here is a visualization for the <strong>Average Treatment Effect (ATE)</strong>. I created a simple bar chart comparing the health outcome for treated and non-treated individuals. The bar chart shows a higher blood pressure for non-treated individuals and a lower blood pressure for treated individuals, showing the positive impacts of the treatment The height difference between the two bars represents the ATE.</p>
<p><strong>ATE Visualization</strong></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-1" tabindex="-1"></a>control_se <span class="ot">&lt;-</span> </span>
<span id="cb33-2"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-2" tabindex="-1"></a>  <span class="fu">sd</span>(data<span class="sc">$</span>ite_estimate[data<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">0</span>]) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(data<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb33-3"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-3" tabindex="-1"></a>treated_se <span class="ot">&lt;-</span> </span>
<span id="cb33-4"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-4" tabindex="-1"></a>  <span class="fu">sd</span>(data<span class="sc">$</span>ite_estimate[data<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">1</span>]) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(data<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb33-5"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-5" tabindex="-1"></a></span>
<span id="cb33-6"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-6" tabindex="-1"></a>control_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(data<span class="sc">$</span>y0_hat[data<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb33-7"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-7" tabindex="-1"></a>treated_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(data<span class="sc">$</span>y1_hat[data<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb33-8"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-8" tabindex="-1"></a></span>
<span id="cb33-9"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-9" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb33-10"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-10" tabindex="-1"></a>  <span class="at">group =</span> <span class="fu">c</span>(<span class="st">&quot;Control (Y0)&quot;</span>, <span class="st">&quot;Treated (Y1)&quot;</span>),</span>
<span id="cb33-11"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-11" tabindex="-1"></a>  <span class="at">ate_estimate =</span> <span class="fu">c</span>(control_mean, treated_mean),</span>
<span id="cb33-12"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-12" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">c</span>(control_mean <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> control_se, treated_mean <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> treated_se),</span>
<span id="cb33-13"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-13" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">c</span>(control_mean <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> control_se, treated_mean <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> treated_se)</span>
<span id="cb33-14"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-14" tabindex="-1"></a>)</span>
<span id="cb33-15"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-15" tabindex="-1"></a></span>
<span id="cb33-16"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-16" tabindex="-1"></a><span class="fu">ggplot</span>(results, <span class="fu">aes</span>(<span class="at">y =</span> group, <span class="at">x =</span> ate_estimate)) <span class="sc">+</span></span>
<span id="cb33-17"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-17" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span>  </span>
<span id="cb33-18"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-18" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> lower, <span class="at">xmax =</span> upper), <span class="at">width =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span> </span>
<span id="cb33-19"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-19" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span> </span>
<span id="cb33-20"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-20" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Estimated Average Treatment Effect&quot;</span>,</span>
<span id="cb33-21"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-21" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Estimated Average Treatment Effect&quot;</span>,</span>
<span id="cb33-22"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-22" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Control vs. Treated&quot;</span>) <span class="sc">+</span></span>
<span id="cb33-23"><a href="foundations-of-causal-thinking-in-public-health.html#cb33-23" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="Causal-Inference-Graduate_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p><strong>Average Treatment Effect on the Treated (ATT)</strong></p>
<p>The <strong>Average Treatment Effect on the Treated (ATT)</strong> measures the impact of a treatment or exposure only among people who received it. Unlike the <strong>Average Treatment Effect (ATE)</strong>, which looks at the effect across the entire population, ATT focuses on those that were actually exposed or treated. ATT is expressed as E[Y(1) - Y(0)|T=1] where Y(1) is the potential outcome with treatment and Y(0) is the potential outcome without treatment, and T=1 indicates only those people who were actually exposed or treated.</p>
<p>ATT helps determine whether the intervention is effective or not for the treated population. It is particularly useful for analyzing policies or medical treatments when the treatment is not randomly assigned. In the case of looking at treatments and blood pressure changes, ATT helps answer the question: How much does the treatment impact the blood pressure of individuals who were actually treated?</p>
<p><strong>Average Treatment Effect on the Treated (ATT) Calculated</strong></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb34-1" tabindex="-1"></a>att <span class="ot">&lt;-</span> <span class="fu">mean</span>(data<span class="sc">$</span>ite_estimate[data<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb34-2"><a href="foundations-of-causal-thinking-in-public-health.html#cb34-2" tabindex="-1"></a></span>
<span id="cb34-3"><a href="foundations-of-causal-thinking-in-public-health.html#cb34-3" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;The Average Treatment Effect on the Treated (ATT) is&quot;</span>, </span>
<span id="cb34-4"><a href="foundations-of-causal-thinking-in-public-health.html#cb34-4" tabindex="-1"></a>            <span class="fu">round</span>(att, <span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;The Average Treatment Effect on the Treated (ATT) is -30.01&quot;</code></pre>
<p><strong>Average Treatment Effect on the Control (ATC)</strong></p>
<p>The <strong>Average Treatment Effect on the Control (ATC)</strong> measures the effect of a treatment on individuals who were not actually exposed to the treatment or exposure. Unlike the <strong>Average Treatment Effect on the Treated (ATT)</strong>, which estimates the impact for those who received the treatment, ATC explains how the control group would have been affected if they have been treated. ATC is expressed as E[Y(1) - Y(0)|T=0] where Y(1) represents the potential outcome with treatment, Y(0) represents the potential outcome without treatment, and T=0 represents people who did not receive treatment. ATC is useful when analyzing policies or medical treatments to understand how untreated individuals would have been affected by the intervention.</p>
<p>In this scenario, ATC answers the question: How much would the treatment have affected individuals who were not exposed to it? To calculate ATC, I took the average treatment effect of the subset of the population that were not exposed to the treatment. If ATC is negative, it means that the treatment would have harmed the control group if they were exposed. By comparing the ATT and the ATC, it helps us determine if the treatment has differential effects across subgroups.</p>
<p><strong>Average Treatment Effect on the Control (ATC) Calculated</strong></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb36-1" tabindex="-1"></a>atc <span class="ot">&lt;-</span> <span class="fu">mean</span>(data<span class="sc">$</span>ite_estimate[data<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb36-2"><a href="foundations-of-causal-thinking-in-public-health.html#cb36-2" tabindex="-1"></a></span>
<span id="cb36-3"><a href="foundations-of-causal-thinking-in-public-health.html#cb36-3" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;The Average Treatment Effect on the Control (ATC) is&quot;</span>, </span>
<span id="cb36-4"><a href="foundations-of-causal-thinking-in-public-health.html#cb36-4" tabindex="-1"></a>            <span class="fu">round</span>(atc, <span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## [1] &quot;The Average Treatment Effect on the Control (ATC) is -27.6&quot;</code></pre>
<p>Now, I’ve created a visualization comparing how the treatment effect differs for treated and control groups.</p>
<p><strong>ATT vs. ATC Visualization</strong></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-1" tabindex="-1"></a>att_se <span class="ot">&lt;-</span> <span class="fu">sd</span>(data<span class="sc">$</span>ite_estimate[data<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">1</span>]) <span class="sc">/</span> </span>
<span id="cb38-2"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-2" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">sum</span>(data<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb38-3"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-3" tabindex="-1"></a></span>
<span id="cb38-4"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-4" tabindex="-1"></a>atc_se <span class="ot">&lt;-</span> <span class="fu">sd</span>(data<span class="sc">$</span>ite_estimate[data<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">0</span>]) <span class="sc">/</span> </span>
<span id="cb38-5"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-5" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">sum</span>(data<span class="sc">$</span>treatment <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb38-6"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-6" tabindex="-1"></a></span>
<span id="cb38-7"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-7" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb38-8"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-8" tabindex="-1"></a>  <span class="at">group =</span> <span class="fu">c</span>(<span class="st">&quot;ATT (Treated)&quot;</span>, <span class="st">&quot;ATC (Control)&quot;</span>),</span>
<span id="cb38-9"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-9" tabindex="-1"></a>  <span class="at">estimate =</span> <span class="fu">c</span>(att, atc),</span>
<span id="cb38-10"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-10" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">c</span>(att <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> att_se, atc <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> atc_se),</span>
<span id="cb38-11"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-11" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">c</span>(att <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> att_se, atc <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> atc_se)</span>
<span id="cb38-12"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-12" tabindex="-1"></a>)</span>
<span id="cb38-13"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-13" tabindex="-1"></a></span>
<span id="cb38-14"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-14" tabindex="-1"></a><span class="fu">ggplot</span>(results, <span class="fu">aes</span>(<span class="at">y =</span> group, <span class="at">x =</span> estimate)) <span class="sc">+</span></span>
<span id="cb38-15"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-15" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span>  </span>
<span id="cb38-16"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-16" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> lower, <span class="at">xmax =</span> upper), <span class="at">width =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span> </span>
<span id="cb38-17"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-17" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span> </span>
<span id="cb38-18"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-18" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Estimated ATT vs. ATC&quot;</span>,</span>
<span id="cb38-19"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-19" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Estimated Treatment Effect&quot;</span>,</span>
<span id="cb38-20"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-20" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Group&quot;</span>) <span class="sc">+</span></span>
<span id="cb38-21"><a href="foundations-of-causal-thinking-in-public-health.html#cb38-21" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="Causal-Inference-Graduate_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Since the ATT is more negative than to ATC, it indicates that the treatment is more effective on the treated group. One potential explanation is that age and cholesterol are confounding variables. There are more older people and people with higher cholesterol levels in the treated group than the non-treated, meaning that this could skew the results as the groups are not homogenous.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="setup.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="randomized-control-trials.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/fbargaglistoffi/causal_inference_graduate/edit/main/01_potential_outcomes.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": "https://github.com/fbargaglistoffi/causal_inference_graduate/blob/main/01_potential_outcomes.Rmd",
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
